require("Timeband","Uxi","Touch","Placeholder");OGX.Timeband=function(n){construct(this,"Timeband");"use strict";var u=this;var a={date:moment(),cb_moved:null,cb_moving:null};var i=OGX.Data.merge(n,a,false);!moment.isMoment(i.date)?i.date=moment(i.date):null;var e;var t=2;var d=10;var o=2;var m;var r=0;var f=0;var s=null;var h=null;var v=moment();this.construct=function(n,a){m=l();e=this.children("Swapper")[0];f=e.el.width();b();e.map([g,g,g]);p(r)};this.enable=function(){};this.disable=function(){};this.ux=function(n){if(n){}else{}};this.resize=function(){f=e.el.width()};this.onMove=function(){};this.onMoved=function(){};this.onRender=function(){};this.pxPerDay=function(){return m};this.date=function(n){!moment.isMoment(n)?n=moment(n):null;i.date=n;b();e.render();p(r)};this.render=function(){e.map([g,g,g]);p(r)};this.zoomIn=function(){if(t+2<=d){t+=2;c()}};this.zoomOut=function(){if(t-2>=o){t-=2;c()}};function c(){var n=O(r);r=0;m=l();var a=Math.ceil(f/2/m);var i=n.mid.clone().subtract(a,"day");h=i;e.render();p(r)}function l(){var n=2;return n*t}function b(){var n=Math.floor(f/m);h=i.date.subtract(Math.round(n/2),"day")}function M(n){if(n.distX){var a=p(r+n.distX);if(i.cb_moving){i.cb_moving(a)}else{u.onMove(a);u.el.trigger(OGX.Timeband.MOVING,a)}}}function x(n){r+=n.distX;var a=O(r);if(i.cb_moved){i.cb_moved(a)}else{u.onMoved(a);u.el.trigger(OGX.Timeband.MOVED,a)}}function O(n){var a=Math.round(f/2/m);var i=Math.floor(n/m);var e=h.clone();e.add(i*-1,"day").add(a,"day");var t=e.clone().subtract(a,"day");var d=e.clone().add(a,"day");var o={mid:e,min:t,max:d};return o}function p(n){var a=O(n);var i=0;if(v.unix()>=a.max.unix()){i=f-1}else{if(v.unix()<=a.min.unix()){i=0}else{var e=(v.unix()-a.min.unix())/(24*60*60);i=e*m}}s.css({transform:"translateX("+Math.abs(i)+"px)"});return a}function g(n){var a=n.abs-1;var i=Math.floor(f/m);var e=h.clone().add(a*i,"day");var t=e.clone().add(i,"day");var d='<div class="container" data-id="'+n.abs+'">';var o=e.clone();var r,s,v;var c=o.date();var l;while(o.unix()<t.unix()){v=o.daysInMonth();r=(v-o.date()+1)*m;s=o.clone().endOf("month");if(s.unix()>t.unix()){c=(s.unix()-t.unix())/(60*60*24);r=(v-1-c)*m;s=t.clone()}r=r*100/f;d+='<div class="month" style="width: '+r+'%;">';if(o.date()===1){if(m<3){l=o.format("YY-MM")}else{l=o.format("YYYY-MM")}d+='<span class="label">'+l+"</span>"}d+="</div>";o=o.endOf("month").add(1,"day")}d+="</div>";n.start=e;n.end=t;u.onRender(n.abs,'.ogx_timeband[data-ogx-id="'+u.id+'"] .container[data-id="'+n.abs+'"]');return d}function y(){u.observeOnce(null,function(){f=u.el.find(".swapper").width()});var n='<div class="today"></div><div class="middle"></div><div class="swapper"></div>';u.el.html(n);s=u.el.find(".today")}function X(){u.el.addClass("ogx_timeband");y();var n={"default > .swapper:Swapper":{cb_moving:M,cb_moved:x}};i["node:OML"]=OGX.OML.rename(n,'.ogx_timeband[data-ogx-id="'+u.id+'"]')}X()};OGX.Timeband.MOVING="timebandMoving";OGX.Timeband.MOVED="timebandMoved";