require("Timeband","Uxi","Touch","Placeholder");OGX.Timeband=function(n){construct(this,"Timeband");"use strict";var f=this;var a={date:moment(),cb_moved:null,cb_moving:null};var e=OGX.Data.merge(n,a,false);!moment.isMoment(e.date)?e.date=moment(e.date):e.date=e.date.clone();var t;var i=2;var d=10;var r=2;var m;var o=0;var h=0;var s=null;var b=null;var v=moment();this.construct=function(n,a){m=l();t=this.children("Swapper")[0];h=t.el.width();u();t.map([O,O,O]);y(o)};this.enable=function(){};this.disable=function(){};this.ux=function(n){if(n){}else{}};this.resize=function(){h=t.el.width()};this.onMove=function(){};this.onMoved=function(){};this.onRender=function(){};this.pxPerDay=function(){return m};this.date=function(n){if(typeof n==="undefined"){return e.date}!moment.isMoment(n)?n=moment(n):n=n.clone();e.date=n;u();t.render();y(o)};this.move=function(n){var a={distX:m*n*-1,dirX:-1};if(n<0){a.dirX=1}t.move(a,true);e.date.add(n,"day");u()};this.render=function(){t.map([O,O,O]);y(o)};this.zoomIn=function(){if(i+2<=d){i+=2;c()}};this.zoomOut=function(){if(i-2>=r){i-=2;c()}};function c(){var n=p(o);o=0;m=l();var a=Math.ceil(h/2/m);var e=n.mid.clone().subtract(a,"day");b=e;t.render();y(o)}function l(){var n=2;return n*i}function u(){var n=Math.floor(h/m);b=e.date.clone().subtract(Math.round(n/2),"day")}function M(n){if(n.distX){var a=y(o+n.distX);if(n.hasOwnProperty("data")&&n.data){}else{if(e.cb_moving){e.cb_moving(a)}else{f.onMove(a);f.el.trigger(OGX.Timeband.MOVING,a)}}}}function x(n){o+=n.distX;var a=p(o);if(e.cb_moved){e.cb_moved(a)}else{f.onMoved(a);f.el.trigger(OGX.Timeband.MOVED,a)}}function p(n){var a=Math.round(h/2/m);var e=Math.floor(n/m);var t=b.clone();t.add(e*-1,"day").add(a,"day");var i=t.clone().subtract(a,"day");var d=t.clone().add(a,"day");var r={mid:t,min:i,max:d};return r}function y(n){var a=p(n);var e=0;if(v.unix()>=a.max.unix()){e=h-1}else{if(v.unix()<=a.min.unix()){e=0}else{var t=(v.unix()-a.min.unix())/(24*60*60);e=t*m}}s.css({transform:"translateX("+Math.abs(e)+"px)"});return a}function O(n){var a=n.abs-1;var e=Math.floor(h/m);var t=b.clone().add(a*e,"day");var i=t.clone().add(e,"day");var d='<div class="container" data-id="'+n.abs+'">';var r=t.clone();var o,s,v;var c=r.date();var l;while(r.unix()<i.unix()){v=r.daysInMonth();o=(v-r.date()+1)*m;s=r.clone().endOf("month");if(s.unix()>i.unix()){c=(s.unix()-i.unix())/(60*60*24);o=(v-1-c)*m;s=i.clone()}o=o*100/h;d+='<div class="month" style="width: '+o+'%;">';if(r.date()===1){if(m<3){l=r.format("YY-MM")}else{l=r.format("YYYY-MM")}d+='<span class="label">'+l+"</span>"}d+="</div>";r=r.endOf("month").add(1,"day")}d+="</div>";n.start=t;n.end=i;var u='.ogx_timeband[data-ogx-id="'+f.id+'"] .container[data-id="'+n.abs+'"]';g(u,f.onRender,[n,u]);return d}function g(n,a,e){var t=setInterval(function(){if($(n).length){clearInterval(t);a.apply(null,e)}},10)}function X(){f.observeOnce(null,function(){h=f.el.find(".swapper").width()});var n='<div class="today"></div><div class="middle"></div><div class="swapper"></div>';f.el.html(n);s=f.el.find(".today")}function w(){f.el.addClass("ogx_timeband");X();var n={"default > .swapper:Swapper":{cb_moving:M,cb_moved:x}};e["node:OML"]=OGX.OML.rename(n,'.ogx_timeband[data-ogx-id="'+f.id+'"]')}w()};OGX.Timeband.MOVING="timebandMoving";OGX.Timeband.MOVED="timebandMoved";