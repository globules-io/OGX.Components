/* OGX.JS Timeband@1.1.0 */
require("Timeband","Uxi","Touch","Placeholder");OGX.Timeband=function(n){construct(this,"Timeband");"use strict";var m=this;var a={date:moment(),cb_moved:null,cb_moving:null};var e=OGX.Data.merge(n,a,false);!moment.isMoment(e.date)?e.date=moment(e.date):e.date=e.date.clone();var t;var i=2;var d=10;var r=2;var f;var o=1;var v=0;var h=0;var c=null;var b=null;var s=moment();this.construct=function(n,a){f=u();t=this.children("Swapper")[0];h=t.el.width();M();t.map([g,g,g]);O(v)};this.resize=function(){var n=t.el.width();o=n/h;h=n;f=u();M();O(v)};this.onMove=function(){};this.onMoved=function(){};this.onRender=function(){};this.pxPerDay=function(){return f};this.date=function(n){if(typeof n==="undefined"){return e.date}!moment.isMoment(n)?n=moment(n):n=n.clone();e.date=n;M();t.render();O(v)};this.move=function(n){var a={distX:f*n*-1,dirX:-1};if(n<0){a.dirX=1}t.move(a,true);e.date.add(n,"day");M()};this.render=function(){t.map([g,g,g]);O(v)};this.zoomIn=function(){if(i+2<=d){i+=2;l()}};this.zoomOut=function(){if(i-2>=r){i-=2;l()}};function l(){var n=y(v);v=0;f=u();var a=Math.ceil(h/2/f);var e=n.mid.clone().subtract(a,"day");b=e;t.render();O(v)}function u(){var n=2;return n*i*o}function M(){var n=Math.floor(h/f);b=e.date.clone().subtract(Math.round(n/2),"day")}function x(n){if(n.distX){var a=O(v+n.distX);if(n.hasOwnProperty("data")&&n.data){}else{if(e.cb_moving){e.cb_moving(a)}else{m.onMove(a);m.el.trigger(OGX.Timeband.MOVING,a)}}}}function p(n){v+=n.distX;var a=y(v);if(e.cb_moved){e.cb_moved(a)}else{m.onMoved(a);m.el.trigger(OGX.Timeband.MOVED,a)}}function y(n){var a=Math.round(h/2/f);var e=Math.floor(n/f);var t=b.clone();t.add(e*-1,"day").add(a,"day");var i=t.clone().subtract(a,"day");var d=t.clone().add(a,"day");var r={mid:t,min:i,max:d};return r}function O(n){var a=y(n);var e=0;if(s.unix()>=a.max.unix()){e=h-1}else{if(s.unix()<=a.min.unix()){e=0}else{var t=(s.unix()-a.min.unix())/(24*60*60);e=t*f}}c.css({transform:"translateX("+Math.abs(e)+"px)"});return a}function g(n){var a=n.abs-1;var e=Math.floor(h/f);var t=b.clone().add(a*e,"day");var i=t.clone().add(e,"day");var d='<div class="container" data-id="'+n.abs+'">';var r=t.clone();var o,v,c;var s=r.date();var l;while(r.unix()<i.unix()){c=r.daysInMonth();o=(c-r.date()+1)*f;v=r.clone().endOf("month");if(v.unix()>i.unix()){s=(v.unix()-i.unix())/(60*60*24);o=(c-1-s)*f;v=i.clone()}o=o*100/h;d+='<div class="month" style="width: '+o+'%;">';if(r.date()===1){if(f<3){l=r.format("YY-MM")}else{l=r.format("YYYY-MM")}d+='<span class="label">'+l+"</span>"}d+="</div>";r=r.endOf("month").add(1,"day")}d+="</div>";n.start=t;n.end=i;var u='.ogx_timeband[data-ogx-id="'+m.id+'"] .container[data-id="'+n.abs+'"]';X(u,m.onRender,[n,u]);return d}function X(n,a,e){var t=setInterval(function(){if($(n).length){clearInterval(t);a.apply(null,e)}},10)}function w(){m.observeOnce(null,function(){h=m.el.find(".swapper").width()});var n='<div class="today"></div><div class="middle"></div><div class="swapper"></div>';m.el.html(n);c=m.el.find(".today")}function _(){m.el.addClass("ogx_timeband");w();var n={"default > .swapper:Swapper":{cb_moving:x,cb_moved:p}};e["node:OML"]=OGX.OML.rename(n,'.ogx_timeband[data-ogx-id="'+m.id+'"]')}_()};OGX.Timeband.MOVING="timebandMoving";OGX.Timeband.MOVED="timebandMoved";