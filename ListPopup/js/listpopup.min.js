/* OGX.JS ListPopup@1.1.0 */
OGX.ListPopup=function(e){var t=this;var i={list:null,mode:"auto",content:{},parent:null,display:{html:'<div class="ogx_list_popup" data-ogx-id="{{$id}}"><div class="ogx_list_popup_item">{{$item}}</div><div class="ogx_list_popup_content">{{$content}}</div></div>',css:""},oml:{"default:Scroller":{}},callbacks:{down:()=>{}},duration:{show:400,hide:500,reset:100},render_mode:1};var a=OGX.Data.merge(e,i);var n=new OGX.Display(a.display);var l=new OGX.Display(a.content);var o=null;var r=null;var s=null;var p=1;var d=0;var u=null;var c={x:0,y:0,h:0};var f=null;var h=false;var m=null;this.content=function(e){if(typeof e==="undefined"){return a.content}a.content=e;l=new OGX.Display(a.content)};this.list=function(e){if(typeof e==="undefined"){return a.list}if(a.list){g(false)}a.list=e;if(a.mode==="auto"){g(true)}};this.open=function(e,t){O(null,e,t)};function g(e){if(e){a.list.el.on(OGX.DynamicList.SELECT,O)}else{a.list.el.off(OGX.DynamicList.SELECT,O)}}function x(e){if(e){f=app.getStage().touch.add("Move",{el:a.el,state:"manual",cb_down:e=>{v();u.addClass("ogx_list_popup_tilt")},cb_up:e=>{if(c.deg<-20||c.deg>20){_()}else{u[0].animate([{transform:"translateY(0px) perspective(600px) rotateX(0deg)"}],{fill:"forwards",composition:"add",duration:a.duration.reset,iterations:1})}},cb_move:e=>{if(e.dirY&&(d>1||p>1)&&(p&&e.dirY===1||d&&e.dirY===-1)){c.deg=e.distY/3*-1;c.ty=e.distY*4;if(c.deg<-20||c.deg>20){_();return}u[0].animate([{transform:"translateY("+c.ty+"px) perspective(600px) rotateX("+c.deg+"deg)"}],{fill:"forwards",composition:"add",duration:0,iterations:1})}else{v()}}});f.enable()}else{f.disable()}}function _(){if(!h){x(false);app.getStage().touch.remove(f);h=true;d=0;p=1;v();u.children(".ogx_list_popup_item").removeClass("ogx_list_popup_shrink").addClass("ogx_list_popup_unshrink");var e=u[0].animate([{transform:"perspective(600px) rotate("+c.deg+"deg)",height:"100%","max-height":"100%"},{transform:"perspective(600px) rotate(0deg) translate(0px, 50%) scale(0.9)"},{transform:"perspective(0px) translate("+c.x+"px,"+c.y+"px)",height:c.h+"px","max-height":c.h+"px"}],{fill:"forwards",duration:a.duration.hide,iterations:1});e.onfinish=e=>{v();if(l.hasOML()){o.kill()}u.remove();a.list.scroller.enable();a.list.enable();h=false;o=null;c={x:0,y:0,h:0,deg:0,ty:0,id:null};r.el.trigger(OGX.ListPopup.CLOSE)}}}function v(){u[0].getAnimations().forEach(e=>{e.cancel()})}function O(e,i,t){a.callbacks.down();r.el.trigger(OGX.ListPopup.OPEN);c.y=t.position().top;c.x=t.position().left;c.h=t.height();c.id=OGX.Object.genId();if(l.hasOML()){u=n.html({id:c.id,item:t[0].outerHTML,content:""})}else{u=n.html({id:c.id,item:t[0].outerHTML,content:l.html(i)})}u=$(u);if(a.list.scroller){a.list.scroller.disable()}y(()=>{if(l.hasOML()){var e=OGX.Data.clone(a.oml);OGX.OML.rename(e,a.el);var t=l.oml("default",i);!Array.isArray(t)?t=[t]:null;e["default:Scroller"]["node:OML"]=t;e["default:Scroller"].callbacks={down:e=>{if(d){d++;p=0}if(p){p++;d=0}},up:e=>{},top:e=>{p=1},bottom:e=>{d=1},scroll:(e,t)=>{p=0;d=0}};e=OGX.OML.rename(e,'.ogx_list_popup[data-ogx-id="'+c.id+'"] .ogx_list_popup_content');if(a.render_mode){X(()=>{L(e,i)})}else{L(e,i,X)}}});s.append(u);a.list.resetSelection();a.list.disable();x(true)}function L(e,t,i){typeof i==="undefined"?i=null:null;var n=u.find(".ogx_list_popup_item");switch(a.render_mode){case 0:n.addClass("ogx_list_popup_shrink");OGX.OML.render(r,e,t,null,e=>{o=e[0];i(()=>{o.resize()})});break;case 1:OGX.OML.render(r,e,t,null,e=>{o=e[0];u.on("transitionend",()=>{u.off("transitionend");o.resize()});n.addClass("ogx_list_popup_shrink")});break;case 2:n.on("animationend",()=>{n.off("animationend");OGX.OML.render(r,e,t,null,e=>{o=e[0]})});n.addClass("ogx_list_popup_shrink");break}}function X(e){typeof e==="undefined"?e=null:null;var t=u[0].animate([{transform:"translate("+c.x+"px,"+c.y+"px) perspective(600px) rotateX(0deg)",height:c.h+"px","max-height":c.h+"px"},{transform:"translate(0px, 50%) scale(0.7) perspective(600px) rotateX(-20deg)"},{transform:"translate(0px, 0px) scale(1) perspective(600px) rotateX(0deg)",height:"calc(100% - 10px)","max-height":"calc(100% - 10px)"}],{fill:"forwards",composition:"add",duration:a.duration.show,iterations:1});if(e){t.onfinish=e}}function y(i){var e={childList:true,subtree:true};var t=new MutationObserver((e,t)=>{e.forEach(()=>{if(m){clearTimeout(m)}m=setTimeout(()=>{i();t.disconnect();t=null},50)})});t.observe(s[0],e)}function b(){if(a.parent){r=a.parent}if(!a.parent&&a.list){r=a.list.parent}!a.el?s=r.el:s=$(a.el);if(a.list&&a.mode==="auto"){g(true)}}b()};OGX.ListPopup.OPEN="LISTPOPUP_OPEN";OGX.ListPopup.CLOSE="LISTPOPUP_CLOSE";