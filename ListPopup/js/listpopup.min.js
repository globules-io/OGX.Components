/* OGX.JS ListPopup@1.0.1 */
OGX.ListPopup=function(t){var e=this;var i={list:null,mode:"auto",content:{},display:{html:'<div class="ogx_list_popup" data-ogx-id="{{$id}}"><div class="ogx_list_popup_item">{{$item}}</div><div class="ogx_list_popup_content">{{$content}}</div></div>',css:""},oml:{"default:Scroller":{}},callbacks:{down:()=>{}},duration:{show:400,hide:500,reset:100},render_mode:1};var l=OGX.Data.merge(t,i);var n=new OGX.Display(l.display);var o=new OGX.Display(l.content);var a=null;var s=1;var r=0;var p=null;var d={x:0,y:0,h:0};var u=null;var c=false;this.content=function(t){if(typeof t==="undefined"){return l.content}l.content=t;o=new OGX.Display(l.content)};this.list=function(t){if(typeof t==="undefined"){return l.list}if(l.list){f(false)}l.list=t;if(l.mode==="auto"){f(true)}};this.open=function(t,e){g(null,t,e)};function f(t){if(t){l.list.el.on(OGX.DynamicList.SELECT,g)}else{l.list.el.off(OGX.DynamicList.SELECT,g)}}function h(t){if(t){u=l.list.touch.add("Move",{parent:l.list,state:"manual",cb_down:t=>{x();p.addClass("ogx_list_popup_tilt")},cb_up:t=>{if(d.deg<-20||d.deg>20){m()}else{p[0].animate([{transform:"translateY(0px) perspective(600px) rotateX(0deg)"}],{fill:"forwards",composition:"add",duration:l.duration.reset,iterations:1})}},cb_move:t=>{if(t.dirY&&(r>1||s>1)&&(s&&t.dirY===1||r&&t.dirY===-1)){d.deg=t.distY/3*-1;d.ty=t.distY*4;if(d.deg<-20||d.deg>20){m();return}p[0].animate([{transform:"translateY("+d.ty+"px) perspective(600px) rotateX("+d.deg+"deg)"}],{fill:"forwards",composition:"add",duration:0,iterations:1})}else{x()}}});u.enable()}else{l.list.el.parent().off(l.list.touch.down,".ogx_list_popup")}}function m(){if(!c){h(false);l.list.touch.remove(u);c=true;r=0;s=1;x();p.children(".ogx_list_popup_item").removeClass("ogx_list_popup_shrink").addClass("ogx_list_popup_unshrink");var t=p[0].animate([{transform:"perspective(600px) rotate("+d.deg+"deg)",height:"100%","max-height":"100%"},{transform:"perspective(600px) rotate(0deg) translate(0px, 50%) scale(0.9)"},{transform:"perspective(0px) translate("+d.x+"px,"+d.y+"px)",height:d.h+"px","max-height":d.h+"px"}],{fill:"forwards",duration:l.duration.hide,iterations:1});t.onfinish=t=>{x();if(o.hasOML()){a.kill()}p.remove();l.list.scroller.enable();l.list.enable();c=false;a=null;d={x:0,y:0,h:0,deg:0,ty:0,id:null};l.list.el.trigger(OGX.ListPopup.CLOSE)}}}function x(){p[0].getAnimations().forEach(t=>{t.cancel()})}function g(t,i,e){l.callbacks.down();l.list.el.trigger(OGX.ListPopup.OPEN);d.y=e.position().top;d.x=e.position().left;d.h=e.height();d.id=OGX.Object.genId();if(o.hasOML()){p=n.html({id:d.id,item:e[0].outerHTML,content:""})}else{p=n.html({id:d.id,item:e[0].outerHTML,content:o.html(i)})}p=$(p);if(l.list.scroller){l.list.scroller.disable()}l.list.observeOnce(null,()=>{if(o.hasOML()){var t=OGX.Data.clone(l.oml);var e=o.oml("default",i);!Array.isArray(e)?e=[e]:null;t["default:Scroller"]["node:OML"]=e;t["default:Scroller"].callbacks={down:t=>{if(r){r++;s=0}if(s){s++;r=0}},up:t=>{},top:t=>{s=1},bottom:t=>{r=1},scroll:(t,e)=>{s=0;r=0}};t=OGX.OML.rename(t,'.ogx_list_popup[data-ogx-id="'+d.id+'"] .ogx_list_popup_content');if(l.render_mode){v(()=>{_(t,i)})}else{_(t,i,v)}}},null);l.list.el.append(p);l.list.resetSelection();l.list.disable();h(true)}function _(t,e,i){typeof i==="undefined"?i=null:null;var n=p.find(".ogx_list_popup_item");switch(l.render_mode){case 0:n.addClass("ogx_list_popup_shrink");OGX.OML.render(l.list.parent,t,e,null,t=>{a=t[0];i(()=>{a.resize()})});break;case 1:OGX.OML.render(l.list.parent,t,e,null,t=>{a=t[0];p.on("transitionend",()=>{p.off("transitionend");a.resize()});n.addClass("ogx_list_popup_shrink")});break;case 2:n.on("animationend",()=>{n.off("animationend");OGX.OML.render(l.list.parent,t,e,null,t=>{a=t[0]})});n.addClass("ogx_list_popup_shrink");break}}function v(t){typeof t==="undefined"?t=null:null;var e=p[0].animate([{transform:"translate("+d.x+"px,"+d.y+"px) perspective(600px) rotateX(0deg)",height:d.h+"px","max-height":d.h+"px"},{transform:"translate(0px, 50%) scale(0.7) perspective(600px) rotateX(-20deg)"},{transform:"translate(0px, 0px) scale(1) perspective(600px) rotateX(0deg)",height:"calc(100% - 10px)","max-height":"calc(100% - 10px)"}],{fill:"forwards",composition:"add",duration:l.duration.show,iterations:1});if(t){e.onfinish=t}}function O(){if(l.list&&l.mode==="auto"){f(true)}}O()};OGX.ListPopup.OPEN="LISTPOPUP_OPEN";OGX.ListPopup.CLOSE="LISTPOPUP_CLOSE";