/* OGX.JS ListPopup@1.0.0 */
OGX.ListPopup=function(t){var e=this;var i={list:null,content:{},display:{html:'<div class="ogx_list_popup" data-ogx-id="{{$id}}"><div class="ogx_list_popup_item">{{$item}}</div><div class="ogx_list_popup_content">{{$content}}</div></div>',css:""},oml:{"default:Scroller":{}},callbacks:{down:()=>{}},duration:{show:400,hide:500,reset:100},render_mode:1};var n=OGX.Data.merge(t,i);var l=new OGX.Display(n.display);var s=new OGX.Display(n.content);var a=null;var o=1;var r=0;var p=null;var d={x:0,y:0,h:0};var u=null;var c=false;this.content=function(t){if(typeof t==="undefined"){return n.content}n.content=t};this.list=function(t){if(typeof t==="undefined"){return n.list}if(n.list){f(false)}n.list=t;f(true)};function f(t){if(t){n.list.el.on(OGX.DynamicList.SELECT,g)}else{n.list.el.off(OGX.DynamicList.SELECT,g)}}function h(t){if(t){u=n.list.touch.add("Move",{parent:n.list,state:"manual",cb_down:t=>{m();p.addClass("ogx_list_popup_tilt")},cb_up:t=>{if(d.deg<-20||d.deg>20){x()}else{p[0].animate([{transform:"translateY(0px) perspective(600px) rotateX(0deg)"}],{fill:"forwards",composition:"add",duration:n.duration.reset,iterations:1})}},cb_move:t=>{if(t.dirY&&(r>1||o>1)&&(o&&t.dirY===1||r&&t.dirY===-1)){d.deg=t.distY/3*-1;d.ty=t.distY*4;if(d.deg<-20||d.deg>20){x();return}p[0].animate([{transform:"translateY("+d.ty+"px) perspective(600px) rotateX("+d.deg+"deg)"}],{fill:"forwards",composition:"add",duration:0,iterations:1})}else{m()}}});u.enable()}else{n.list.el.parent().off(n.list.touch.down,".ogx_list_popup")}}function x(){if(!c){h(false);n.list.touch.remove(u);c=true;r=0;o=1;m();p.children(".ogx_list_popup_item").removeClass("ogx_list_popup_shrink").addClass("ogx_list_popup_unshrink");var t=p[0].animate([{transform:"perspective(600px) rotate("+d.deg+"deg)",height:"100%","max-height":"100%"},{transform:"perspective(600px) rotate(0deg) translate(0px, 50%) scale(0.9)"},{transform:"perspective(0px) translate("+d.x+"px,"+d.y+"px)",height:d.h+"px","max-height":d.h+"px"}],{fill:"forwards",duration:n.duration.hide,iterations:1});t.onfinish=t=>{m();if(s.hasOML()){a.kill()}p.remove();n.list.scroller.enable();n.list.enable();c=false;a=null;d={x:0,y:0,h:0,deg:0,ty:0,id:null};n.list.el.trigger(OGX.ListPopup.CLOSE)}}}function m(){p[0].getAnimations().forEach(t=>{t.cancel()})}function g(t,i,e){n.callbacks.down();n.list.el.trigger(OGX.ListPopup.OPEN);d.y=e.position().top;d.x=e.position().left;d.h=e.height();d.id=OGX.Object.genId();if(s.hasOML()){p=l.html({id:d.id,item:e[0].outerHTML,content:""})}else{p=l.html({id:d.id,item:e[0].outerHTML,content:s.html(i)})}p=$(p);if(n.list.scroller){n.list.scroller.disable()}n.list.observeOnce(null,()=>{if(s.hasOML()){var t=OGX.Data.clone(n.oml);var e=s.oml("default",i);!Array.isArray(e)?e=[e]:null;t["default:Scroller"]["node:OML"]=e;t["default:Scroller"].callbacks={down:t=>{if(r){r++;o=0}if(o){o++;r=0}},up:t=>{},top:t=>{o=1},bottom:t=>{r=1},scroll:(t,e)=>{o=0;r=0}};t=OGX.OML.rename(t,'.ogx_list_popup[data-ogx-id="'+d.id+'"] .ogx_list_popup_content');if(n.render_mode){v(()=>{_(t,i)})}else{_(t,i,v)}}},null);n.list.el.append(p);n.list.resetSelection();n.list.disable();h(true)}function _(t,e,i){typeof i==="undefined"?i=null:null;var l=p.find(".ogx_list_popup_item");switch(n.render_mode){case 0:l.addClass("ogx_list_popup_shrink");OGX.OML.render(n.list.parent,t,e,null,t=>{a=t[0];i(()=>{a.resize()})});break;case 1:OGX.OML.render(n.list.parent,t,e,null,t=>{a=t[0];p.on("transitionend",()=>{p.off("transitionend");a.resize()});l.addClass("ogx_list_popup_shrink")});break;case 2:l.on("animationend",()=>{l.off("animationend");OGX.OML.render(n.list.parent,t,e,null,t=>{a=t[0]})});l.addClass("ogx_list_popup_shrink");break}}function v(t){typeof t==="undefined"?t=null:null;var e=p[0].animate([{transform:"translate("+d.x+"px,"+d.y+"px) perspective(600px) rotateX(0deg)",height:d.h+"px","max-height":d.h+"px"},{transform:"translate(0px, 50%) scale(0.7) perspective(600px) rotateX(-20deg)"},{transform:"translate(0px, 0px) scale(1) perspective(600px) rotateX(0deg)",height:"calc(100% - 10px)","max-height":"calc(100% - 10px)"}],{fill:"forwards",composition:"add",duration:n.duration.show,iterations:1});if(t){e.onfinish=t}}function O(){if(n.list){f(true)}}O()};OGX.ListPopup.OPEN="LISTPOPUP_OPEN";OGX.ListPopup.CLOSE="LISTPOPUP_CLOSE";