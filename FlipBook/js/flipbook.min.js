/* OGX.JS FlipBook@1.4.4 */
require("FlipBook","Uxi","Placeholder","Touch");OGX.FlipBook=function(e){construct(this,"FlipBook");"use strict";var r=this;var _=e;var o={css:false,index:0,capture:false,burst:true,callbacks:{change:null},display:false,displays:false,as:"item",list:null};var i=200;var h=0;var a=[];var d=null;var f;var t=false;var u=false;var g=[];this.construct=function(){v();this.el.on("transitionend",function(){t=false});if(_.index){this.index(_.index,false)}};this.onFocus=function(){setTimeout(s,0)};this.onBlur=function(){};this.focus=function(){if(this.blured){this.blured=false;this.ux(true);this.onFocus()}s();return this};this.ux=function(e){if(e){this.el.on(this.touch.down,".ogx_flip_book_sheet",function(e){if(u){return false}p();var o=$(this);setTimeout(()=>{n(o)},0)})}else{this.el.off(this.touch.down,".ogx_flip_book_sheet")}};this.destroy=function(){this.el.off("transitionend")};this.onChange=function(){};this.index=function(e,o,i){if(typeof e==="undefined"){return h}if(typeof i==="undefined"){i=false}if(typeof o==="undefined"){o=300}if(h===e){return}if(u){return}p();u=true;var t=Math.abs(h-e);var n;e>h?n=1:n=-1;var s=h;if(n===-1){s--}var l=s+t*n;var a=o;for(var f=s;f!==l;f+=n){c(f,a,i);a+=o}g.push(setTimeout(()=>{u=false},a));return this};this.render=function(e,o){this.empty();_["node:OML"]=e;k();b(()=>{OGX.OML.render(this,_["node:OML"],o,null,()=>{v();s()})})};this.list=function(e){if(typeof e==="undefined"){return _.list}this.empty();_.list=e;if(_.list&&_.list.length){this.render(m(_.list))}};function p(){g.forEach(e=>{clearTimeout(e)});g=[]}function c(o,e){g.push(setTimeout(()=>{t=false;var e=r.el.find('.ogx_flip_book_sheet[data-sheet="'+o+'"]');n(e,false)},e))}function n(e,o){t=true;typeof o==="undefined"?o=true:null;if(_.capture){__e.stopImmediatePropagation()}i++;if(!e.hasClass("ogx_flip_book_flip")){h++;e.next(".ogx_flip_book_sheet").css("z-index",i-1).removeClass("ogx_flip_book_flip");e.css("z-index",i).addClass("ogx_flip_book_flip")}else{h--;e.css("z-index",i-1).removeClass("ogx_flip_book_flip");e.prev(".ogx_flip_book_sheet").addClass("ogx_flip_book_flip")}if(h===a.length){r.el.removeClass("ogx_flip_book_open").addClass("ogx_flip_book_end")}else if(h){r.el.removeClass("ogx_flip_book_end").addClass("ogx_flip_book_open")}else{r.el.removeClass("ogx_flip_book_end ogx_flip_book_open")}s();if(o){r.onChange(h);f.trigger(OGX.FlipBook.FLIP,h)}}function s(){if(!r.blured){for(var e=0;e<a.length;e++){for(var o=0;o<a[e].length;o++){if(a[e][o].instance){if(l(e,o)){a[e][o].instance.focus()}else{a[e][o].instance.blur()}}}}}}function l(e,o){var i=x(h);for(var t=0;t<i.length;t++){if(i[t].sheet===e&&i[t].page===o){return true}}return false}function x(e){if(!e){return[{sheet:e,page:0}]}else if(e<a.length){return[{sheet:e-1,page:1},{sheet:e,page:0}]}else{return[{sheet:e,page:1}]}}function v(){var e,o,i;for(var t=0;t<a.length;t++){for(var n=0;n<a[t].length;n++){o=f.children(".ogx_flip_book_sheet:nth-child("+(t+1)+")").children(".ogx_flip_book_page:nth-child("+(n+1)+")");i=o.find("div[data-ogx-id]").first();if(i.length){e=i.data("ogx-id");if(i.hasClass("ogx_scroller_outer")){e=i.find(".ogx_scroller_inner").first().data("ogx-id")}a[t][n].instance=r.nodes.get({id:{eq:String(e)}},null,1)}}}}function b(e){var o="";var i;var t=Math.ceil((_["node:OML"].length-1)/2);if(a.length){for(var n=0;n<a.length;n++){for(var s=0;s<a[n].length;s++){if(a[n][s].instance){a[n][s].instance.kill()}}}a=[]}total_pages=0;var l;for(var n=0;n<t;n++){l=t-n;i=new OGX.List([{index:total_pages,instance:null},{index:total_pages+1,instance:null}]);a.push(i);o+='<div class="ogx_flip_book_sheet" data-sheet="'+n+'" style="z-index:'+l+';">';o+='<div class="ogx_flip_book_page ogx_flip_book_front" data-page="'+total_pages+'"></div>';total_pages++;o+='<div class="ogx_flip_book_page ogx_flip_book_back" data-page="'+total_pages+'"></div>';o+="</div>";total_pages++}r.observeOnce(null,e);f.html(o)}function k(){var e=[];for(var o=0;o<_["node:OML"].length;o++){e.push('.ogx_flip_book[data-ogx-id="'+r.id+'"] > .ogx_flip_book_sheet[data-sheet="'+o+'"] > .ogx_flip_book_front');e.push('.ogx_flip_book[data-ogx-id="'+r.id+'"] > .ogx_flip_book_sheet[data-sheet="'+o+'"] > .ogx_flip_book_back')}r.placeholders(_,e)}function m(e){var o=[];if(!e||!e.length){return o}var i,t;var n=Math.ceil((e.length-1)/2);var s=0;for(var l=0;l<n;l++){for(var a=0;a<2;a++){if(d.hasOML()){i=d.oml('.ogx_flip_book[data-ogx-id="'+r.id+'"] > .ogx_flip_book_sheet[data-sheet="'+l+'"] > .ogx_flip_book_page[data-page="'+s+'"]',e[l],_.as);o.push(i)}else{t=d.html(e[l]);var f='{"default:Html":{"html":'+JSON.stringify(t)+', "instance": true}}';i=JSON.parse(f);o.push(i)}s++}}return o}function O(){OGX.Data.merge(_,o);if(_.callbacks.change){r.onChange=_.callbacks.change}d=new OGX.Display(_);typeof _.index==="string"?_.index=OGX.Data.stringToVal(_.index):null;h=_.index;if(_.list&&_.list.length){_["node:OML"]=m(_.list)}}function y(){f=r.el;f.addClass("ogx_flip_book");O();if(_.hasOwnProperty("node:OML")&&_["node:OML"].length){k();b(v)}}y()};OGX.FlipBook.FLIP="FlipBookFlip";