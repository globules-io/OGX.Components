/* OGX.JS FlipBook@1.4.1 */
require("FlipBook","Uxi","Placeholder","Touch");OGX.FlipBook=function(e){construct(this,"FlipBook");"use strict";var r=this;var d=e;var o={css:false,index:0,capture:false,callbacks:{change:null},display:false,displays:false,as:"item",list:null};var t=200;var f=0;var s=[];var _=null;var a;var n=false;this.construct=function(){u();this.el.on("transitionend",function(){n=false});if(d.index){this.index(d.index,false)}};this.onFocus=function(){setTimeout(l,0)};this.onBlur=function(){};this.focus=function(){if(this.blured){this.blured=false;this.ux(true);this.onFocus()}l();return this};this.ux=function(e){if(e){this.el.on(this.touch.down,".ogx_flip_book_sheet",i)}else{this.el.off(this.touch.down,".ogx_flip_book_sheet",i)}};this.destroy=function(){this.el.off("transitionend")};this.onChange=function(){};this.index=function(e,o,i){if(typeof e==="undefined"){return f}if(typeof i==="undefined"){i=false}if(typeof o==="undefined"){o=200}if(f===e){return}var t=Math.abs(f-e);var n;e>f?n=1:n=-1;var l=f;if(n===-1){l--;t}var s=l+t*n;for(var a=l;a!==s;a+=n){h(a,o,i)}return this};this.render=function(e,o){this.empty();d["node:OML"]=e;x();c(()=>{OGX.OML.render(this,d["node:OML"],o,null,()=>{u();l()})})};this.list=function(e){if(typeof e==="undefined"){return d.list}this.empty();d.list=e;if(d.list&&d.list.length){this.render(v(d.list))}};function h(e,o){setTimeout(()=>{n=false;r.el.find('.ogx_flip_book_sheet[data-sheet="'+e+'"]').trigger(r.touch.down,false)},o*e)}function i(e,o){if(n){return}n=true;typeof o==="undefined"?o=true:null;if(d.capture){e.stopImmediatePropagation()}var i=$(this);t++;if(!i.hasClass("ogx_flip_book_flip")){f++;i.css("z-index",t).addClass("ogx_flip_book_flip")}else{f--;i.css("z-index",t-1).removeClass("ogx_flip_book_flip")}if(f===d["node:OML"].length+1){r.el.find(".ogx_flip_book").removeClass("ogx_flip_book_open").addClass("ogx_flip_book_end")}else if(f){r.el.find(".ogx_flip_book").removeClass("ogx_flip_book_end").addClass("ogx_flip_book_open")}else{r.el.find(".ogx_flip_book").removeClass("ogx_flip_book_end ogx_flip_book_open")}l();if(o){r.onChange(f);a.trigger(OGX.FlipBook.FLIP,f)}}function l(){if(!r.blured){for(var e=0;e<s.length;e++){for(var o=0;o<s[e].length;o++){if(s[e][o].instance){if(g(e,o)){s[e][o].instance.focus()}else{s[e][o].instance.blur()}}}}}}function g(e,o){var i=p(f);for(var t=0;t<i.length;t++){if(i[t].sheet===e&&i[t].page===o){return true}}return false}function p(e){if(!e){return[{sheet:e,page:0}]}else if(e<s.length){return[{sheet:e-1,page:1},{sheet:e,page:0}]}else{return[{sheet:e,page:1}]}}function u(){var e,o,i;for(var t=0;t<s.length;t++){for(var n=0;n<s[t].length;n++){o=a.children(".ogx_flip_book_sheet:nth-child("+(t+1)+")").children(".ogx_flip_book_page:nth-child("+(n+1)+")");i=o.find("div[data-ogx-id]").first();if(i.length){e=i.data("ogx-id");if(i.hasClass("ogx_scroller_outer")){e=i.find(".ogx_scroller_inner").first().data("ogx-id")}s[t][n].instance=r.nodes.get({id:{eq:String(e)}},null,1)}}}}function c(e){var o="";var i;var t;total_sheets=Math.ceil((d["node:OML"].length-1)/2);if(s.length){for(var n=0;n<s.length;n++){for(var l=0;l<s[n].length;l++){if(s[n][l].instance){s[n][l].instance.kill()}}}s=[]}total_pages=0;for(var n=0;n<total_sheets;n++){i=100-n;t=new OGX.List([{index:total_pages,instance:null},{index:total_pages+1,instance:null}]);s.push(t);o+='<div class="ogx_flip_book_sheet" data-sheet="'+n+'" style="z-index:'+i+';">';o+='<div class="ogx_flip_book_page ogx_flip_book_front" data-page="'+total_pages+'"></div>';total_pages++;o+='<div class="ogx_flip_book_page ogx_flip_book_back" data-page="'+total_pages+'"></div>';o+="</div>";total_pages++}r.observeOnce(null,e);a.html(o)}function x(){var e=[];for(var o=0;o<d["node:OML"].length;o++){e.push('.ogx_flip_book[data-ogx-id="'+r.id+'"] > .ogx_flip_book_sheet[data-sheet="'+o+'"] > .ogx_flip_book_front');e.push('.ogx_flip_book[data-ogx-id="'+r.id+'"] > .ogx_flip_book_sheet[data-sheet="'+o+'"] > .ogx_flip_book_back')}r.placeholders(d,e)}function v(e){var o=[];if(!e||!e.length){return o}var i,t;var n=Math.ceil((e.length-1)/2);var l=0;for(var s=0;s<n;s++){for(var a=0;a<2;a++){if(_.hasOML()){i=_.oml('.ogx_flip_book[data-ogx-id="'+r.id+'"] > .ogx_flip_book_sheet[data-sheet="'+s+'"] > .ogx_flip_book_page[data-page="'+l+'"]',e[s],d.as);o.push(i)}else{t=_.html(e[s]);var f='{"default:Html":{"html":'+JSON.stringify(t)+', "instance": true}}';i=JSON.parse(f);o.push(i)}l++}}return o}function k(){OGX.Data.merge(d,o);if(d.callbacks.change){r.onChange=d.callbacks.change}_=new OGX.Display(d);typeof d.index==="string"?d.index=OGX.Data.stringToVal(d.index):null;f=d.index;if(d.list&&d.list.length){d["node:OML"]=v(d.list)}}function b(){a=r.el;a.addClass("ogx_flip_book");k();if(d.hasOwnProperty("node:OML")&&d["node:OML"].length){x();c(u)}}b()};OGX.FlipBook.FLIP="FlipBookFlip";