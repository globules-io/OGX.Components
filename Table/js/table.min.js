/* OGX.JS Table@1.0.0 */
require("Table","Uxi","Touch");OGX.Table=function(a){construct(this,"Table");"use strict";var t=this;var e={max_rows:30,prop_search:10,editable:false,display:{html:'<span class="ogx_table_row">{{$fields}}</span>',css:"ogx_table_row"},list:[]};var d=OGX.Data.merge(a,e,false);var r,s;var o;var _=1;var p=0;var i=[];var n=null;var c=null;this.construct=function(){o=this.children("DynamicList")[0];s=r.children(".ogx_table_browse");x(true)};this.ux=function(a){if(a){this.on(this.touch.down,".ogx_table_page",l);this.on(this.touch.down,".ogx_table_prop",h)}else{this.off(this.touch.down,".ogx_table_page",l);this.off(this.touch.down,".ogx_table_prop",h)}};this.resize=function(){};this.destroy=function(){};this.val=function(a){if(typeof a==="undefined"){return d.list}else{d.list=a;p=0;i=[];c=null;n=null;x(true)}};this.page=function(){return p};function l(a){var e=$(this).data("page");if(e!==p){p=e;x(false)}}function h(a){var e=$(this);var t=e.data("prop");var l=Number(e.attr("data-sort"));if(l===1){l=-1}else{l=1}n={prop:t,way:l};e.attr("data-sort",l);e.parent().children(".ogx_table_selected_prop").removeClass("ogx_table_selected_prop");e.addClass("ogx_table_selected_prop");p=0;x(false)}function v(a,e){typeof e==="undefined"?e=0:null;var t=[];for(var l=0;l<a.length;l++){if(e&&l>e){return t}for(var s in a[l]){if(!t.includes(s)){t.push(s)}}}return t}function f(a){var e="";var t=a.length;var l=100/t;for(var s=0;s<t;s++){e+='<span class="ogx_table_row_value" data-prop="'+a[s]+'" style="width:'+l+'%">{{';e+="typeof $"+a[s]+' === "object" && !Array.isArray($'+a[s]+') ? @val = "{...}" : @val = $'+a[s]+";";e+='typeof @val === "object" && Array.isArray(@val) ? @val = "[...]" : null;';e+='typeof @val === "string" && @val.indexOf("</") !== -1 ? @val = "&#60;/&#62;" : null;';e+="}}{{@val}}</span>"}return e}function u(a){var e="";var t=a.length;var l=100/t;for(var s=0;s<a.length;s++){e+='<span class="ogx_table_prop" data-prop="'+a[s]+'" data-sort="1" style="width:'+l+'%">'+a[s]+"</span>"}r.children(".ogx_table_head").html(e)}function g(a){_=Math.ceil(a.length/d.max_rows);var e="";var t="";var l=2;var s,r;var o=[];var i=0;s=p-l;r=p+l+1;if(s<0){i=Math.abs(s)}else{if(r>_-1){i=r-_-1}}s+=i;r+=i;r>_-1?r=_-1:null;for(var n=s;n<r;n++){if(!o.includes(n)){o.push(n)}}if(!o.includes(0)){o.unshift(0)}if(!o.includes(_-1)){o.push(_-1)}for(var n=0;n<o.length;n++){if(o[n]===p){t="ogx_table_selected_page"}else{t=""}e+='<span class="ogx_table_page '+t+'" data-page="'+o[n]+'">'+(o[n]+1)+"</span>"}return e}function x(a){var e=d.list;!e.hasOwnProperty("insert")?e=new OGX.List(e):null;if(e.length){o.wipe();if(n){e.order(n.prop,n.way)}if(a){i=v(e,d.prop_search);var t=f(i);u(i);c=d.display.html;c=c.replace("{{$fields}}",t)}o.display({display:{html:c,css:"ogx_table_row"}});if(e.length>d.max_rows){e=OGX.Data.clone(e).splice(p*d.max_rows,p*d.max_rows+d.max_rows);var l=g(d.list);s.html(l).removeClass("ogx_table_hidden")}else{s.html("").addClass("ogx_table_hidden")}o.val(e)}else{u([]);o.val([])}}function b(){r=t.el;r.addClass("ogx_table");var a='<div class="ogx_table_head"></div><div class="ogx_table_rows"></div><div class="ogx_table_browse ogx_table_hidden"></div>';r.html(a);var e={"default > .ogx_table_rows:DynamicList":{key:"_id",scroll:true,scope:false,display:OGX.Data.clone(d.display)}};d["node:OML"]=OGX.OML.rename(e,'.ogx_uxi[data-ogx-id="'+t.id+'"]')}b()};