/* OGX.JS Table@1.1.1 */
require("Table","Uxi","Touch");OGX.Table=function(a){construct(this,"Table");"use strict";var t=this;var e={key:"_id",max_rows:30,resize_rows:false,prop_search:10,editable:false,display:{html:'<span class="ogx_table_row">{{$fields}}</span>',css:"ogx_table_row"},list:[],mapping:null};var p=OGX.Data.merge(a,e,false);var s,l;var i;var d=1;var f=0;var o=[];var n=null;var _=null;this.construct=function(){i=this.children("DynamicList")[0];l=s.children(".ogx_table_browse");b(true)};this.ux=function(a){if(a){this.on(this.touch.down,".ogx_table_page",r);this.on(this.touch.down,".ogx_table_prop",h)}else{this.off(this.touch.down,".ogx_table_page",r);this.off(this.touch.down,".ogx_table_prop",h)}};this.resize=function(){};this.destroy=function(){};this.val=function(a){if(typeof a==="undefined"){return p.list}else{p.list=a;f=0;o=[];_=null;n=null;b(true)}};this.page=function(){return f};function r(a){var e=$(this).data("page");if(e!==f){f=e;b(false)}}function h(a){var e=$(this);var t=e.data("prop");var r=Number(e.attr("data-sort"));if(r===1){r=-1}else{r=1}n={prop:t,way:r};e.attr("data-sort",r);e.parent().children(".ogx_table_selected_prop").removeClass("ogx_table_selected_prop");e.addClass("ogx_table_selected_prop");f=0;b(false)}function v(a){var e=0;for(var t=0;t<a.length;t++){a[t].index>e?e=a[t].index+1:null}return e}function u(a,e){typeof e==="undefined"?e=0:null;var t=new OGX.List;for(var r=0;r<a.length;r++){if(e&&r>e){t.order("index",1);return t}var l,s;for(var i in a[r]){l=i;if(!t.get({prop:{eq:i}},null,1)){if(p.mapping&&p.mapping.hasOwnProperty(i)){l=p.mapping[i].label}if(p.mapping&&p.mapping[i].hasOwnProperty("index")){s=p.mapping[i].index}else{s=v(t)}t.push({prop:i,label:l,index:s})}}}t.order("index",1);return t}function c(a){var e="";var t=a.length;var r=100/t;for(var l=0;l<t;l++){e+='<span class="ogx_table_row_value" data-prop="'+a[l].prop+'" style="width:'+r+'%">{{';e+="typeof $"+a[l].prop+' === "object" && !Array.isArray($'+a[l].prop+') ? @val = "{...}" : @val = $'+a[l].prop+";";e+='typeof @val === "object" && Array.isArray(@val) ? @val = "[...]" : null;';e+='typeof @val === "string" && @val.indexOf("</") !== -1 ? @val = "&#60;/&#62;" : null;';e+="}}{{@val}}</span>"}return e}function g(a){var e="";var t=a.length;var r=100/t;for(var l=0;l<a.length;l++){e+='<span class="ogx_table_prop" data-prop="'+a[l].prop+'" data-sort="1" style="width:'+r+'%">'+a[l].label+"</span>"}s.children(".ogx_table_head").html(e)}function x(a){d=Math.ceil(a.length/p.max_rows);var e="";var t="";var r=2;var l,s;var i=[];var o=0;l=f-r;s=f+r+1;if(l<0){o=Math.abs(l)}else{if(s>d-1){o=s-d-1}}l+=o;s+=o;s>d-1?s=d-1:null;for(var n=l;n<s;n++){if(!i.includes(n)){i.push(n)}}if(!i.includes(0)){i.unshift(0)}if(!i.includes(d-1)){i.push(d-1)}for(var n=0;n<i.length;n++){if(i[n]===f){t="ogx_table_selected_page"}else{t=""}e+='<span class="ogx_table_page '+t+'" data-page="'+i[n]+'">'+(i[n]+1)+"</span>"}return e}function b(a){var e=p.list;!e.hasOwnProperty("insert")?e=new OGX.List(e):null;if(e.length){i.wipe();if(n){e.order(n.prop,n.way)}if(a){o=u(e,p.prop_search);var t=c(o);g(o);_=p.display.html;_=_.replace("{{$fields}}",t)}i.display({display:{html:_,css:"ogx_table_row"}});if(e.length>p.max_rows){e=OGX.Data.clone(e).splice(f*p.max_rows,f*p.max_rows+p.max_rows);var r=x(p.list);l.html(r).removeClass("ogx_table_hidden")}else{l.html("").addClass("ogx_table_hidden")}i.val(e)}else{g([]);i.val([])}}function w(){s=t.el;s.addClass("ogx_table");var a='<div class="ogx_table_head"></div><div class="ogx_table_rows"></div><div class="ogx_table_browse ogx_table_hidden"></div>';s.html(a);var e={"default > .ogx_table_rows:DynamicList":{key:p.key,scroll:true,scope:false,display:OGX.Data.clone(p.display)}};p["node:OML"]=OGX.OML.rename(e,'.ogx_uxi[data-ogx-id="'+t.id+'"]')}w()};