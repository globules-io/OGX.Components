/* OGX.JS FlexCells@1.7.0 */
require("FlexCells","Uxi","Template","Touch","Placeholder");OGX.FlexCells=function(e){construct(this,"FlexCells");"use strict";var x=this;var l={axis:"x",axis_swap:false,min:10,template:null,auto_hide:true,children:["50%","30%","20%"]};var o=OGX.Data.merge(e,l,false);var _=this.el;var h={x:0,y:0,m:0};var u=null;var n=-1;this.construct=function(){t()};this.onResize=function(){if(o.axis_swap){var e=this.el.width();var l=null;for(var s in o.axis_swap){if(e>=Number(s)){l=o.axis_swap[s]}}if(l){this.axis(l)}}};this.getCellIndex=function(e){var l=_.children(".ogx_flex_cell").toArray();for(var s=0;s<l.length;s++){if(l[s].getAttribute("data-cell-id")===String(e)){return s}}return false};this.addCell=function(e,l,s){typeof l=="undefined"?l=o.children.length:null;typeof s=="undefined"&&typeof l=="object"?[s,l]=[l,0]:null;var i=100-Number(e.slice(0,-1));for(var r=0;r<o.children.length;r++){o.children[r]=Number(o.children[r].slice(0,-1))/100*i+"%"}var a='<span class="ogx_flex_cell_resize"></span>';var t='<div class="ogx_flex_cell" data-cell-id="'+c()+'" data-cell="'+n+'" style="flex-basis:'+e+'"></div>';if(l===o.children.length){_.append(a+t);o.children.push(e)}else{if(!l){_.prepend(t+a);o.children.unshift(e)}else{_.children(".ogx_flex_cell:eq("+l+")").before(t+a);o.children.splice(l,0,e)}}if(s){OGX.OML.rename(s,this.selector+" .ogx_flex_cell:eq("+l+")");o["node:OML"].push(s);OGX.OML.render(this,s)}else{o["node:OML"].push({})}return l};this.removeCell=function(e){if(o.children.length<3){return}var l=_.children(".ogx_flex_cell:eq("+e+")");if(l){var s=l.find(".ogx_uxi").first();if(s.length){this.nodes.get({id:s.data("ogx-id")},null,1).kill()}var i=o.children.splice(e,1);if(!e){l.next().remove()}else{if(e!==o.children.length){l.next().remove()}}l.remove();var r=100-Number(i[0].slice(0,-1));for(var a=0;a<o.children.length-1;a++){o.children[a]=Number(o.children[a].slice(0,-1))/100*r+"%"}return true}return false};this.cellSize=function(s,e){if(typeof s==="undefined"){var l=[];return o.children}var i,r;if(Array.isArray(s)){var a;this.el.children(".ogx_flex_cell").each((e,l)=>{a=$(l);a.css("flex-basis",s[e]);o.children[e]=s[e]})}else{typeof e==="string"?e=Number(e.replace("%","")):null;var t,n;var c;i=this.el.children(".ogx_flex_cell:eq("+s+")");if(s<this.el.children(".ogx_flex_cell").length-1){r=this.el.children(".ogx_flex_cell:eq("+(s+1)+")");c=s+1}else{r=this.el.children(".ogx_flex_cell:eq("+(s-1)+")");c=s-1}t=e-Number(i.css("flex-basis").split("%").shift());n=Number(r.css("flex-basis").split("%").shift())-t;i.css("flex-basis",e+"%");r.css("flex-basis",n+"%");o.children[s]=e;o.children[c]=n}if(o.auto_hide){setTimeout(()=>{f()},300)}setTimeout(()=>this.resizeNodes(),5)};this.renderAt=function(e,l){this.clearAt(e);l=OGX.OML.rename(l,'.ogx_flex_cells[data-ogx-id="'+this.id+'"] > .ogx_flex_cell:eq('+e+")");o["node:OML"].push(l);OGX.OML.render(this,l)};this.clearAt=function(e){var s,i;this.el.children(".ogx_flex_cell:eq("+e+")").find(".ogx_uxi").each(function(e,l){s=$(l).data("ogx-id");i=x.find(null,s);if(i){i.kill()}})};this.flatten=function(e){if(e){x.el.children(".ogx_flex_cell_resize").addClass("ogx_flex_resize_hidden");x.el.addClass("ogx_flex_cells_col").removeClass("ogx_flex_cells_row")}else{x.el.children(".ogx_flex_cell_resize").removeClass("ogx_flex_resize_hidden");x.el.addClass("ogx_flex_cells_row").removeClass("ogx_flex_cells_col")}};this.axis=function(e){if(typeof e==="undefined"){return o.axis}if(e===o.axis){return}if(o.axis==="x"){_.removeClass("ogx_flex_cells_row").addClass("ogx_flex_cells_col")}else{_.removeClass("ogx_flex_cells_col").addClass("ogx_flex_cells_row")}o.axis=e;x.touch.remove("move");t()};function f(){var s=x.el.children(".ogx_flex_cell_resize");s.each((e,l)=>{if(e<s.length){el=$(l);cellA=el.prev().css("flex-basis");cellB=el.next().css("flex-basis");if([0,"0%"].includes(cellA)||[0,"0%"].includes(cellB)){el.addClass("ogx_flex_resize_hidden")}else{el.removeClass("ogx_flex_resize_hidden")}}})}function c(){n++;return x.id+"_"+n}function s(){var e="";var l=[];var s;for(var i=0;i<o.children.length;i++){s=c();l.push(s);e+='<span class="ogx_flex_cell" data-cell-id="'+s+'" data-cell="'+n+'" style="flex-basis:'+o.children[i]+'"></span>';if(i<o.children.length-1){e+='<span class="ogx_flex_cell_resize"></span>'}}_.html(e);return l}function i(e){u=$(e.target);h.x=0;h.y=0;h.m=0;x.blurNodes()}function r(e){var l;var s=_.width();if(o.axis==="x"){l=(e.distX-h.m)*100/s;h.m=e.distX}else{l=(e.distY-h.m)*100/_.height();h.m=e.distY}var i=Number(u.prev().css("flex-basis").split("%")[0]);var r=Number(u.next().css("flex-basis").split("%")[0]);var a=u.prev();var t=u.next();var n=x.getCellIndex(a.data("cell-id"));var c=n+1;var f,d;if(Array.isArray(o.min)){f=o.min[n];d=o.min[c]}else{f=d=o.min}if(!isNaN(f)){f=f*100/s}else{f=Number(f.replace("%",""))}if(!isNaN(d)){d=d*100/s}else{d=Number(d.replace("%",""))}if(i+l>f&&r-l>d){var a=u.prev();var t=u.next();a.css("flex-basis",i+l+"%");t.css("flex-basis",r-l+"%");o.children[n]=i+l;o.children[c]=i+l;x.el.trigger(OGX.FlexCells.RESIZE);setTimeout(()=>x.resizeNodes(),10)}}function a(){x.focusNodes()}function t(){var e={id:"move",min:0,target:".ogx_flex_cell_resize",cb_down:i,cb_move:r,cb_up:a,capture:true};if(o.axis==="x"){e.x=true;e.y=false}else{e.y=true;e.x=false}x.touch.add("Move",e)}function d(){var e=_.children();var s=e.length;var i=[];var r;e.each(function(e,l){r=c();i.push(r);$(l).addClass("ogx_flex_cell").attr("data-cell-id",r).attr("data-cell",n).css("flex-basis",o.children[e]);if(e<s-1){$(l).after('<span class="ogx_flex_cell_resize"></span>')}});return i}function v(){var e=_.parent().children().not(".ogx_flex_cells");var l=e.clone();var s=[];var i=e.length;var r=[];var a;var t;l.each((e,l)=>{t=$(l);a=c();r.push(a);t.addClass("ogx_flex_cell").css("flex-basis",o.children[e]);l.setAttribute("data-cell-id",String(a)).setAttribute("data-cell",n);s.push(t);if(e<i-1){s.push($('<span class="ogx_flex_cell_resize"></span>'))}});_.append(s);e.remove();if(i){return r}return false}function g(e){var l=[];for(var s=0;s<o["node:OML"].length;s++){l.push('.ogx_flex_cells[data-ogx-id="'+x.id+'"] > .ogx_flex_cell[data-cell-id="'+e[s]+'"]')}x.placeholders(o,l)}function p(){_.addClass("ogx_flex_cells");if(o.axis==="x"){_.addClass("ogx_flex_cells_row")}else{_.addClass("ogx_flex_cells_col")}var e=false;if(!o.template){e=v()}else{e=d()}if(!o.template&&!e){e=s()}g(e);if(o.auto_hide){f()}}p()};OGX.FlexCells.RESIZE="FlexCellsResize";